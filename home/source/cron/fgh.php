<?php
/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
if(!defined('IN_UCHOME')) {
	exit('Access Denied');
}

$cropstime = array(
				"1" => array( 14400, 28800, 46800, 64800, 86405, 90000000 ),
				"40" => array( 7200, 14400, 21600, 28800, 28805, 90000000 ),
				"2" => array( 7200, 14400, 25200, 36000, 36005, 90000000 ),
				"3" => array( 7200, 18000, 32400, 46800, 46805, 90000000 ),
				"4" => array( 7200, 14400, 25200, 36000, 50405, 90000000 ),
				"5" => array( 7200, 14400, 25200, 39600, 54005, 90000000 ),
				"6" => array( 7200, 18000, 28800, 43200, 57605, 90000000 ),
				"7" => array( 7200, 18000, 32400, 46800, 61205, 90000000 ),
				"8" => array( 10800, 21600, 32400, 46800, 64805, 90000000 ),
				"9" => array( 10800, 25200, 39600, 54000, 72005, 90000000 ),
				"10" => array( 7200, 14400, 25200, 36000, 36005, 90000000 ),
				"11" => array( 14400, 28800, 43200, 57600, 75605, 90000000 ),
				"12" => array( 14400, 32400, 54000, 72000, 93600, 90000000 ),
				"13" => array( 28800, 61200, 93600, 129600, 165605, 90000000 ),
				"14" => array( 14400, 32400, 54000, 75600, 100805, 90000000 ),
				"15" => array( 18000, 39600, 61200, 86400, 111605, 90000000 ),
				"16" => array( 21600, 46800, 72000, 97200, 126005, 90000000 ),
				"17" => array( 25200, 54000, 82800, 111600, 140405, 90000000 ),
				"18" => array( 28800, 57600, 86400, 118800, 151205, 90000000 ),
				"19" => array( 25200, 50400, 75600, 104400, 133205, 90000000 ),
				"20" => array( 39600, 90000, 147600, 205200, 262805, 90000000 ),
				"21" => array( 32400, 68400, 104400, 158400, 212405, 90000000 ),
				"22" => array( 28800, 72000, 129600, 187200, 234005, 90000000 ),
				"23" => array( 36000, 72000, 108000, 147600, 187205, 90000000 ),
				"24" => array( 39600, 79200, 118800, 162000, 208805, 90000000 ),
				"26" => array( 39600, 82800, 126000, 172800, 219605, 90000000 ),
				"27" => array( 43200, 90000, 136800, 183600, 230405, 90000000 ),
				"29" => array( 36000, 75600, 115200, 154800, 198005, 90000000 ),
				"31" => array( 39600, 82800, 126000, 172800, 219605, 90000000 ),
				"33" => array( 46800, 97200, 147600, 198000, 252005, 90000000 ),
				"34" => array( 50400, 100800, 151200, 205200, 259205, 90000000 ),
				"35" => array( 54000, 108000, 165600, 219600, 277205, 90000000 ),
				"36" => array( 57600, 115200, 172800, 230400, 291605, 90000000 ),
				"101" => array( 7200, 18000, 28800, 43200, 57605, 90000000 ),
				"102" => array( 7200, 18000, 28800, 43200, 57605, 90000000 ),
				"103" => array( 7200, 18000, 28800, 43200, 57605, 90000000 ),
				"104" => array( 7200, 18000, 28800, 43200, 57605, 90000000 ),
				"105" => array( 10800, 25200, 43200, 64800, 86405, 90000000 ),
				"106" => array( 10800, 25200, 43200, 64800, 86405, 90000000 ),
				"107" => array( 10800, 25200, 43200, 64800, 86405, 90000000 ),
				"108" => array( 10800, 25200, 43200, 64800, 86405, 90000000 ),
				"109" => array( 10800, 25200, 46800, 68400, 93605, 90000000 ),
				"110" => array( 10800, 25200, 46800, 68400, 93605, 90000000 ),
				"111" => array( 10800, 25200, 46800, 68400, 93605, 90000000 ),
				"112" => array( 10800, 25200, 46800, 68400, 93605, 90000000 ),
				"113" => array( 10800, 25200, 46800, 68400, 97205, 90000000 ),
				"114" => array( 10800, 25200, 46800, 68400, 97205, 90000000 ),
				"115" => array( 10800, 25200, 46800, 68400, 97205, 90000000 ),
				"116" => array( 10800, 25200, 46800, 68400, 97205, 90000000 ),
				"117" => array( 14400, 28800, 54000, 75600, 100805, 90000000 ),
				"118" => array( 14400, 28800, 54000, 75600, 100805, 90000000 ),
				"119" => array( 14400, 28800, 54000, 75600, 100805, 90000000 ),
				"120" => array( 14400, 28800, 54000, 75600, 100805, 90000000 ),
				"121" => array( 14400, 32400, 50400, 79200, 108005, 90000000 ),
				"122" => array( 14400, 32400, 50400, 79200, 108005, 90000000 ),
				"123" => array( 14400, 32400, 50400, 79200, 108005, 90000000 ),
				"124" => array( 14400, 32400, 50400, 79200, 108005, 90000000 ),
				"125" => array( 14400, 32400, 54000, 82800, 115205, 90000000 ),
				"126" => array( 14400, 32400, 54000, 82800, 115205, 90000000 ),
				"127" => array( 14400, 32400, 54000, 82800, 115205, 90000000 ),
				"128" => array( 14400, 32400, 54000, 82800, 115205, 90000000 ),
				"129" => array( 7200, 32400, 61200, 93600, 129605, 90000000 ),
				"130" => array( 7200, 32400, 61200, 93600, 129605, 90000000 ),
				"131" => array( 7200, 32400, 61200, 93600, 129605, 90000000 ),
				"132" => array( 7200, 32400, 61200, 93600, 129605, 90000000 ),
				"2001" => array( 7200, 25200, 50400, 79200, 144000, 90000000 ),
				"2002" => array( 7200, 25200, 50400, 79200, 144000, 90000000 ),
				"2003" => array( 7200, 25200, 50400, 79200, 144000, 90000000 )
);
$query = $_SGLOBAL['db']->query('SELECT uid,farmlandstatus FROM '.tname('plug_newfarm'));
    while ($value = $_SGLOBAL['db']->fetch_array($query)) {
                $list[] = $value;
    }
foreach ($list as $userparameter) {
    $farm=(array) json_decode($userparameter[farmlandstatus]);
    foreach ($farm[farmlandstatus] as $key=>$value){
		//f 草 g 虫子 h 干旱 s 大虫子 t 虫子当前血量 u 虫子总血量
        if(($_SGLOBAL['timestamp']-$value->q)<$cropstime[$value->a][4])
        {
            $suiji=mt_rand(1,20);

            if($value->f==0)
            {
                if ($suiji<10)
                {
                    if ($suiji<4)
                    {
                        if ($suiji<2)
                        {
                            $value->f=3;
                        }
                        else
                        {
                            $value->f=2;
                        }
                    }
                    else
                    {
                        $value->f=1;
                    }
                }
            }
            $suiji=mt_rand(1,20);
            if($value->g==0 && ($_SGLOBAL['timestamp']-$value->q)>$cropstime[$value->a][2])
            {
                if ($suiji<10)
                {
                    if ($suiji<4)
                    {
                        if ($suiji<2)
                        {
                            $value->g=3;
                        }
                        else
                        {
                            $value->g=2;
                        }
                    }
                    else
                    {
                        $value->g=1;
                    }
                }
            }
            $suiji=mt_rand(1,20);
            if($value->h==1)
            {
                if ($suiji<7)
                {
                    $value->h=0;
                }
            }
            $suiji=mt_rand(1,100);
            if($value->s==0 && ($_SGLOBAL['timestamp']-$value->q)>$cropstime[$value->a][2])
            {
				//控制大虫只在开花，成熟阶段出现
                if ($suiji<10)
                {
                    $value->s=1;
					$value->t=4;
					$value->u=4;
                }
            }
        }
    }
    $farm=json_encode($farm);
    $_SGLOBAL['db']->query("UPDATE ".tname('plug_newfarm')." set farmlandstatus='".$farm."' where uid=".$userparameter[uid]);

}
//牧场大便
$suiji = rand(1,3);
$_SGLOBAL['db']->query("UPDATE ".tname('plug_newfarm')." set dabian=dabian+".$suiji." where dabian<10");
//牧场大便
exit()

?>
